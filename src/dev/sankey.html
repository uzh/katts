<html title="sankey">

<style>
.node rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}
.node text {
  pointer-events: none;
  text-shadow: 0 1px 0 #fff;
}
.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}
.link:hover {
  stroke-opacity: .5;
}
</style>

<body>
<p id="chart">
<script type="text/javascript" src="http://d3js.org/d3.v2.min.js"></script>
<script type="text/javascript" src="https://raw.github.com/d3/d3-plugins/master/sankey/sankey.js"></script>
<script>
var units = "Messages";

var margin = {top: 10, right: 10, bottom: 10, left: 10},
    width = 5600 - margin.left - margin.right,
    height = 3200 - margin.top - margin.bottom;

var formatNumber = d3.format(",.0f"),    // zero decimal places
    format = function(d) { return formatNumber(d) + " " + units; },
    color = d3.scale.category20();

// append the svg canvas to the page
var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

// Set the sankey diagram properties
var sankey = d3.sankey()
    .nodeWidth(36)
    .nodePadding(40)
    .size([width, height]);

var path = sankey.link();

graph = JSON.parse('{"nodes":[{"name":"46"},{"name":"2"},{"name":"57"},{"name":"24"},{"name":"23"},{"name":"1"},{"name":"4"},{"name":"22"},{"name":"3"},{"name":"6"},{"name":"58"},{"name":"5"},{"name":"25"},{"name":"7"},{"name":"84"},{"name":"15"},{"name":"27"},{"name":"10"},{"name":"11"},{"name":"12"},{"name":"13"},{"name":"18"},{"name":"19"},{"name":"14"},{"name":"16"},{"name":"17"},{"name":"75"},{"name":"64"},{"name":"26"},{"name":"28"},{"name":"68"},{"name":"37"},{"name":"93"},{"name":"38"},{"name":"21"},{"name":"80"},{"name":"76"},{"name":"20"},{"name":"53"},{"name":"36"},{"name":"92"},{"name":"82"},{"name":"83"},{"name":"85"},{"name":"62"},{"name":"45"},{"name":"55"},{"name":"8"},{"name":"74"},{"name":"29"},{"name":"81"},{"name":"78"},{"name":"50"},{"name":"51"},{"name":"41"},{"name":"52"},{"name":"54"},{"name":"56"},{"name":"79"},{"name":"9"},{"name":"47"},{"name":"49"},{"name":"48"},{"name":"39"},{"name":"35"},{"name":"34"},{"name":"43"},{"name":"42"},{"name":"44"},{"name":"40"},{"name":"94"},{"name":"96"},{"name":"33"},{"name":"32"},{"name":"31"},{"name":"30"},{"name":"91"},{"name":"90"},{"name":"87"},{"name":"86"},{"name":"88"},{"name":"89"},{"name":"66"},{"name":"59"},{"name":"70"},{"name":"67"},{"name":"95"},{"name":"60"},{"name":"63"},{"name":"61"},{"name":"73"},{"name":"77"},{"name":"72"},{"name":"69"},{"name":"65"},{"name":"71"}],"links":[{"source":80,"value":455,"target":35},{"source":7,"value":41103,"target":17},{"source":14,"value":954,"target":22},{"source":80,"value":282844,"target":50},{"source":80,"value":455,"target":41},{"source":80,"value":455,"target":42},{"source":41,"value":910,"target":34},{"source":14,"value":1399,"target":24},{"source":80,"value":455,"target":14},{"source":41,"value":984,"target":37},{"source":14,"value":882,"target":15},{"source":80,"value":455,"target":43},{"source":14,"value":844,"target":21},{"source":50,"value":752,"target":37},{"source":14,"value":970,"target":25},{"source":72,"value":455,"target":1},{"source":42,"value":821,"target":25},{"source":35,"value":1123,"target":24},{"source":72,"value":455,"target":8},{"source":42,"value":969,"target":24},{"source":35,"value":941,"target":15},{"source":50,"value":954,"target":34},{"source":42,"value":894,"target":22},{"source":35,"value":1173,"target":21},{"source":72,"value":455,"target":5},{"source":42,"value":1204,"target":21},{"source":35,"value":1019,"target":25},{"source":72,"value":455,"target":9},{"source":72,"value":455,"target":13},{"source":72,"value":455,"target":6},{"source":72,"value":92615,"target":11},{"source":38,"value":455,"target":5},{"source":50,"value":1060,"target":21},{"source":42,"value":1147,"target":37},{"source":50,"value":855,"target":22},{"source":42,"value":1047,"target":34},{"source":38,"value":455,"target":11},{"source":38,"value":91824,"target":6},{"source":38,"value":455,"target":8},{"source":38,"value":455,"target":1},{"source":38,"value":455,"target":13},{"source":38,"value":455,"target":9},{"source":80,"value":455,"target":58},{"source":41,"value":875,"target":25},{"source":41,"value":1052,"target":21},{"source":41,"value":969,"target":22},{"source":14,"value":1071,"target":37},{"source":14,"value":738,"target":34},{"source":41,"value":1020,"target":24},{"source":35,"value":1048,"target":34},{"source":41,"value":784,"target":15},{"source":35,"value":976,"target":37},{"source":65,"value":455,"target":5},{"source":65,"value":455,"target":1},{"source":65,"value":455,"target":8},{"source":65,"value":455,"target":6},{"source":65,"value":455,"target":11},{"source":50,"value":1096,"target":25},{"source":65,"value":91970,"target":9},{"source":50,"value":949,"target":24},{"source":65,"value":455,"target":13},{"source":50,"value":792,"target":15},{"source":56,"value":455,"target":1},{"source":56,"value":455,"target":5},{"source":69,"value":92615,"target":11},{"source":56,"value":455,"target":6},{"source":69,"value":455,"target":6},{"source":42,"value":945,"target":15},{"source":56,"value":455,"target":8},{"source":69,"value":455,"target":13},{"source":35,"value":864,"target":22},{"source":56,"value":455,"target":9},{"source":69,"value":455,"target":9},{"source":56,"value":92615,"target":11},{"source":69,"value":455,"target":5},{"source":56,"value":455,"target":13},{"source":69,"value":455,"target":8},{"source":69,"value":455,"target":1},{"source":7,"value":39154,"target":19},{"source":7,"value":39159,"target":18},{"source":7,"value":40748,"target":23},{"source":7,"value":38284,"target":20},{"source":92,"value":455,"target":29},{"source":1,"value":11876,"target":15},{"source":8,"value":14122,"target":21},{"source":92,"value":455,"target":16},{"source":1,"value":13163,"target":24},{"source":8,"value":12261,"target":22},{"source":8,"value":13656,"target":24},{"source":8,"value":14510,"target":25},{"source":74,"value":455,"target":6},{"source":1,"value":12229,"target":22},{"source":90,"value":455,"target":16},{"source":90,"value":455,"target":28},{"source":8,"value":12196,"target":15},{"source":74,"value":455,"target":1},{"source":1,"value":14234,"target":25},{"source":74,"value":92006,"target":8},{"source":1,"value":14090,"target":21},{"source":90,"value":455,"target":29},{"source":74,"value":455,"target":5},{"source":53,"value":455,"target":8},{"source":6,"value":13842,"target":21},{"source":53,"value":92019,"target":1},{"source":54,"value":14642,"target":13},{"source":53,"value":455,"target":5},{"source":54,"value":105379,"target":9},{"source":54,"value":12247,"target":11},{"source":9,"value":12922,"target":34},{"source":6,"value":12315,"target":22},{"source":9,"value":15705,"target":37},{"source":13,"value":12741,"target":34},{"source":11,"value":12520,"target":22},{"source":13,"value":15823,"target":37},{"source":11,"value":14245,"target":21},{"source":54,"value":455,"target":6},{"source":11,"value":14777,"target":25},{"source":54,"value":455,"target":8},{"source":11,"value":13666,"target":24},{"source":54,"value":455,"target":1},{"source":11,"value":12272,"target":15},{"source":53,"value":455,"target":6},{"source":54,"value":455,"target":5},{"source":1,"value":15968,"target":37},{"source":1,"value":12878,"target":34},{"source":73,"value":455,"target":13},{"source":7,"value":39160,"target":47},{"source":73,"value":455,"target":8},{"source":7,"value":38593,"target":59},{"source":73,"value":91824,"target":6},{"source":73,"value":455,"target":11},{"source":73,"value":455,"target":9},{"source":8,"value":16114,"target":37},{"source":8,"value":13394,"target":34},{"source":73,"value":455,"target":1},{"source":67,"value":92017,"target":13},{"source":55,"value":455,"target":1},{"source":13,"value":14250,"target":25},{"source":11,"value":13270,"target":34},{"source":67,"value":455,"target":9},{"source":13,"value":13284,"target":24},{"source":55,"value":455,"target":6},{"source":13,"value":12324,"target":22},{"source":55,"value":92006,"target":8},{"source":13,"value":14062,"target":21},{"source":90,"value":274153,"target":3},{"source":90,"value":455,"target":12},{"source":90,"value":455,"target":7},{"source":11,"value":16100,"target":37},{"source":13,"value":11938,"target":15},{"source":90,"value":455,"target":4},{"source":92,"value":455,"target":12},{"source":92,"value":455,"target":28},{"source":92,"value":274204,"target":4},{"source":9,"value":13352,"target":24},{"source":67,"value":13281,"target":5},{"source":92,"value":455,"target":3},{"source":6,"value":15857,"target":37},{"source":9,"value":11820,"target":15},{"source":9,"value":14241,"target":21},{"source":67,"value":455,"target":8},{"source":55,"value":455,"target":9},{"source":92,"value":455,"target":7},{"source":9,"value":14159,"target":25},{"source":67,"value":455,"target":1},{"source":55,"value":455,"target":11},{"source":67,"value":455,"target":11},{"source":9,"value":12186,"target":22},{"source":67,"value":455,"target":6},{"source":55,"value":455,"target":13},{"source":5,"value":13359,"target":24},{"source":5,"value":14103,"target":25},{"source":59,"value":455,"target":81},{"source":59,"value":455,"target":80},{"source":5,"value":11935,"target":15},{"source":59,"value":266198,"target":78},{"source":59,"value":455,"target":79},{"source":5,"value":14165,"target":21},{"source":5,"value":12303,"target":22},{"source":66,"value":455,"target":11},{"source":66,"value":455,"target":9},{"source":66,"value":455,"target":8},{"source":66,"value":455,"target":6},{"source":66,"value":92050,"target":5},{"source":66,"value":455,"target":1},{"source":70,"value":455,"target":71},{"source":66,"value":455,"target":13},{"source":5,"value":12741,"target":34},{"source":75,"value":92019,"target":1},{"source":83,"value":455,"target":28},{"source":75,"value":455,"target":5},{"source":83,"value":455,"target":16},{"source":75,"value":455,"target":6},{"source":83,"value":455,"target":29},{"source":75,"value":455,"target":8},{"source":75,"value":455,"target":9},{"source":83,"value":455,"target":7},{"source":75,"value":455,"target":11},{"source":83,"value":455,"target":4},{"source":83,"value":274546,"target":3},{"source":75,"value":455,"target":13},{"source":83,"value":455,"target":12},{"source":68,"value":455,"target":6},{"source":68,"value":455,"target":11},{"source":68,"value":455,"target":9},{"source":68,"value":455,"target":13},{"source":68,"value":455,"target":5},{"source":68,"value":91708,"target":1},{"source":68,"value":455,"target":8},{"source":5,"value":16174,"target":37},{"source":43,"value":1045,"target":15},{"source":43,"value":1071,"target":25},{"source":43,"value":1021,"target":24},{"source":43,"value":1236,"target":22},{"source":43,"value":891,"target":21},{"source":45,"value":91703,"target":8},{"source":45,"value":455,"target":6},{"source":45,"value":455,"target":5},{"source":45,"value":455,"target":1},{"source":45,"value":455,"target":13},{"source":45,"value":455,"target":11},{"source":45,"value":455,"target":9},{"source":46,"value":91970,"target":9},{"source":46,"value":455,"target":13},{"source":46,"value":455,"target":6},{"source":70,"value":455,"target":51},{"source":43,"value":1021,"target":37},{"source":46,"value":455,"target":11},{"source":43,"value":1192,"target":34},{"source":46,"value":455,"target":1},{"source":46,"value":455,"target":8},{"source":46,"value":455,"target":5},{"source":0,"value":455,"target":5},{"source":0,"value":455,"target":1},{"source":0,"value":455,"target":8},{"source":0,"value":91498,"target":6},{"source":0,"value":455,"target":11},{"source":0,"value":455,"target":9},{"source":0,"value":455,"target":13},{"source":57,"value":455,"target":11},{"source":57,"value":455,"target":9},{"source":57,"value":92017,"target":13},{"source":57,"value":455,"target":5},{"source":57,"value":455,"target":1},{"source":57,"value":455,"target":8},{"source":57,"value":455,"target":6},{"source":37,"value":489,"target":32},{"source":47,"value":455,"target":80},{"source":47,"value":455,"target":81},{"source":87,"value":455,"target":3},{"source":87,"value":274950,"target":12},{"source":87,"value":455,"target":28},{"source":47,"value":269271,"target":79},{"source":87,"value":455,"target":16},{"source":47,"value":455,"target":78},{"source":87,"value":455,"target":7},{"source":71,"value":829572,"target":2},{"source":87,"value":455,"target":4},{"source":21,"value":495,"target":32},{"source":25,"value":508,"target":32},{"source":47,"value":455,"target":77},{"source":59,"value":455,"target":40},{"source":59,"value":455,"target":77},{"source":59,"value":455,"target":76},{"source":76,"value":455,"target":58},{"source":47,"value":455,"target":76},{"source":47,"value":455,"target":40},{"source":29,"value":39214,"target":18},{"source":29,"value":39472,"target":19},{"source":85,"value":455,"target":7},{"source":85,"value":455,"target":4},{"source":89,"value":455,"target":7},{"source":29,"value":40939,"target":17},{"source":85,"value":455,"target":3},{"source":89,"value":455,"target":4},{"source":30,"value":455,"target":29},{"source":85,"value":281200,"target":12},{"source":89,"value":455,"target":3},{"source":85,"value":455,"target":28},{"source":89,"value":455,"target":12},{"source":85,"value":455,"target":16},{"source":89,"value":274783,"target":28},{"source":85,"value":455,"target":29},{"source":30,"value":455,"target":3},{"source":40,"value":455,"target":35},{"source":30,"value":455,"target":12},{"source":40,"value":455,"target":50},{"source":30,"value":280080,"target":28},{"source":30,"value":455,"target":16},{"source":40,"value":455,"target":41},{"source":40,"value":455,"target":42},{"source":40,"value":455,"target":14},{"source":29,"value":38388,"target":20},{"source":30,"value":455,"target":7},{"source":40,"value":280752,"target":43},{"source":29,"value":40833,"target":23},{"source":30,"value":455,"target":4},{"source":93,"value":455,"target":29},{"source":34,"value":460,"target":32},{"source":93,"value":281233,"target":16},{"source":93,"value":455,"target":7},{"source":93,"value":455,"target":3},{"source":93,"value":455,"target":4},{"source":93,"value":455,"target":28},{"source":93,"value":455,"target":12},{"source":52,"value":455,"target":11},{"source":32,"value":455,"target":86},{"source":52,"value":455,"target":9},{"source":52,"value":455,"target":8},{"source":52,"value":455,"target":6},{"source":16,"value":40918,"target":17},{"source":16,"value":38973,"target":18},{"source":16,"value":39240,"target":19},{"source":52,"value":455,"target":13},{"source":16,"value":38283,"target":20},{"source":81,"value":455,"target":58},{"source":16,"value":40814,"target":23},{"source":28,"value":39133,"target":18},{"source":28,"value":38975,"target":19},{"source":28,"value":38065,"target":20},{"source":28,"value":40548,"target":23},{"source":52,"value":92373,"target":5},{"source":52,"value":455,"target":1},{"source":28,"value":41037,"target":17},{"source":3,"value":40709,"target":23},{"source":3,"value":38188,"target":20},{"source":3,"value":40987,"target":17},{"source":3,"value":38859,"target":19},{"source":3,"value":38836,"target":18},{"source":81,"value":455,"target":14},{"source":81,"value":455,"target":42},{"source":12,"value":39124,"target":18},{"source":12,"value":41127,"target":17},{"source":81,"value":455,"target":43},{"source":12,"value":38141,"target":20},{"source":81,"value":455,"target":35},{"source":12,"value":38947,"target":19},{"source":81,"value":269133,"target":41},{"source":12,"value":40471,"target":23},{"source":81,"value":455,"target":50},{"source":24,"value":455,"target":32},{"source":71,"value":830560,"target":93},{"source":71,"value":832886,"target":91},{"source":71,"value":830560,"target":36},{"source":71,"value":829330,"target":90},{"source":71,"value":827523,"target":92},{"source":71,"value":828370,"target":26},{"source":71,"value":829837,"target":48},{"source":71,"value":829572,"target":95},{"source":71,"value":832886,"target":84},{"source":40,"value":455,"target":58},{"source":87,"value":455,"target":29},{"source":71,"value":827523,"target":10},{"source":71,"value":829330,"target":83},{"source":71,"value":828370,"target":30},{"source":71,"value":829837,"target":85},{"source":44,"value":455,"target":29},{"source":71,"value":829330,"target":82},{"source":44,"value":275288,"target":16},{"source":71,"value":827523,"target":94},{"source":44,"value":455,"target":28},{"source":71,"value":829572,"target":27},{"source":71,"value":832886,"target":88},{"source":71,"value":830560,"target":44},{"source":71,"value":828370,"target":89},{"source":71,"value":829837,"target":87},{"source":89,"value":455,"target":29},{"source":89,"value":455,"target":16},{"source":18,"value":455,"target":40},{"source":18,"value":455,"target":76},{"source":17,"value":455,"target":76},{"source":17,"value":455,"target":77},{"source":17,"value":455,"target":40},{"source":18,"value":455,"target":77},{"source":17,"value":455,"target":81},{"source":18,"value":455,"target":80},{"source":18,"value":269133,"target":81},{"source":18,"value":455,"target":78},{"source":23,"value":455,"target":80},{"source":18,"value":455,"target":79},{"source":23,"value":455,"target":78},{"source":23,"value":455,"target":79},{"source":23,"value":455,"target":81},{"source":17,"value":282844,"target":80},{"source":17,"value":455,"target":78},{"source":17,"value":455,"target":79},{"source":15,"value":478,"target":32},{"source":44,"value":455,"target":12},{"source":44,"value":455,"target":3},{"source":44,"value":455,"target":4},{"source":44,"value":455,"target":7},{"source":23,"value":455,"target":77},{"source":23,"value":455,"target":76},{"source":23,"value":280752,"target":40},{"source":4,"value":40871,"target":23},{"source":4,"value":38857,"target":19},{"source":4,"value":38177,"target":20},{"source":4,"value":40905,"target":17},{"source":4,"value":38870,"target":18},{"source":36,"value":455,"target":12},{"source":36,"value":455,"target":28},{"source":36,"value":455,"target":4},{"source":36,"value":455,"target":3},{"source":22,"value":499,"target":32},{"source":36,"value":274949,"target":16},{"source":36,"value":455,"target":29},{"source":91,"value":276136,"target":29},{"source":91,"value":455,"target":28},{"source":91,"value":455,"target":16},{"source":91,"value":455,"target":3},{"source":91,"value":455,"target":12},{"source":91,"value":455,"target":7},{"source":91,"value":455,"target":4},{"source":36,"value":455,"target":7},{"source":76,"value":455,"target":42},{"source":76,"value":455,"target":41},{"source":76,"value":455,"target":50},{"source":76,"value":455,"target":35},{"source":76,"value":455,"target":43},{"source":76,"value":263421,"target":14},{"source":77,"value":455,"target":58},{"source":51,"value":366378,"target":61},{"source":51,"value":368780,"target":60},{"source":51,"value":366200,"target":62},{"source":51,"value":366356,"target":45},{"source":51,"value":365605,"target":0},{"source":51,"value":367804,"target":66},{"source":51,"value":366400,"target":68},{"source":51,"value":365605,"target":38},{"source":51,"value":366356,"target":55},{"source":51,"value":366400,"target":53},{"source":51,"value":367804,"target":52},{"source":51,"value":367804,"target":39},{"source":51,"value":366400,"target":31},{"source":51,"value":366356,"target":33},{"source":51,"value":365605,"target":63},{"source":51,"value":365605,"target":73},{"source":51,"value":368780,"target":72},{"source":51,"value":366200,"target":65},{"source":51,"value":366378,"target":64},{"source":51,"value":368780,"target":69},{"source":51,"value":366378,"target":67},{"source":51,"value":366200,"target":54},{"source":51,"value":368780,"target":56},{"source":51,"value":366200,"target":46},{"source":51,"value":366378,"target":57},{"source":2,"value":455,"target":29},{"source":2,"value":275617,"target":7},{"source":2,"value":455,"target":4},{"source":77,"value":455,"target":43},{"source":77,"value":455,"target":14},{"source":2,"value":455,"target":28},{"source":77,"value":269386,"target":42},{"source":2,"value":455,"target":16},{"source":77,"value":455,"target":41},{"source":2,"value":455,"target":3},{"source":77,"value":455,"target":50},{"source":2,"value":455,"target":12},{"source":77,"value":455,"target":35},{"source":19,"value":455,"target":40},{"source":19,"value":269386,"target":77},{"source":19,"value":455,"target":76},{"source":62,"value":455,"target":13},{"source":62,"value":91655,"target":9},{"source":62,"value":455,"target":11},{"source":62,"value":455,"target":6},{"source":20,"value":263421,"target":76},{"source":27,"value":455,"target":4},{"source":20,"value":455,"target":40},{"source":27,"value":279562,"target":7},{"source":20,"value":455,"target":77},{"source":29,"value":39405,"target":47},{"source":29,"value":38730,"target":59},{"source":20,"value":455,"target":81},{"source":62,"value":455,"target":1},{"source":20,"value":455,"target":80},{"source":62,"value":455,"target":8},{"source":20,"value":455,"target":78},{"source":20,"value":455,"target":79},{"source":62,"value":455,"target":5},{"source":19,"value":455,"target":81},{"source":19,"value":455,"target":80},{"source":19,"value":455,"target":78},{"source":79,"value":455,"target":50},{"source":79,"value":455,"target":35},{"source":19,"value":455,"target":79},{"source":60,"value":455,"target":6},{"source":60,"value":455,"target":8},{"source":60,"value":455,"target":9},{"source":60,"value":92300,"target":11},{"source":79,"value":455,"target":43},{"source":79,"value":455,"target":14},{"source":60,"value":455,"target":13},{"source":79,"value":455,"target":42},{"source":79,"value":455,"target":41},{"source":16,"value":39136,"target":47},{"source":16,"value":38466,"target":59},{"source":79,"value":269271,"target":58},{"source":60,"value":455,"target":5},{"source":60,"value":455,"target":1},{"source":51,"value":366400,"target":75},{"source":51,"value":366356,"target":74},{"source":10,"value":455,"target":28},{"source":10,"value":455,"target":12},{"source":51,"value":367804,"target":49},{"source":10,"value":455,"target":3},{"source":10,"value":274573,"target":4},{"source":58,"value":1041,"target":34},{"source":48,"value":455,"target":7},{"source":10,"value":455,"target":7},{"source":58,"value":946,"target":37},{"source":48,"value":455,"target":3},{"source":48,"value":455,"target":4},{"source":26,"value":455,"target":4},{"source":26,"value":455,"target":7},{"source":10,"value":455,"target":29},{"source":10,"value":455,"target":16},{"source":26,"value":455,"target":29},{"source":63,"value":455,"target":5},{"source":26,"value":274417,"target":28},{"source":63,"value":455,"target":8},{"source":26,"value":455,"target":16},{"source":63,"value":455,"target":1},{"source":26,"value":455,"target":3},{"source":63,"value":455,"target":11},{"source":26,"value":455,"target":12},{"source":63,"value":91824,"target":6},{"source":48,"value":455,"target":16},{"source":49,"value":455,"target":6},{"source":48,"value":455,"target":29},{"source":49,"value":455,"target":8},{"source":49,"value":455,"target":9},{"source":48,"value":274597,"target":12},{"source":48,"value":455,"target":28},{"source":49,"value":455,"target":11},{"source":61,"value":455,"target":9},{"source":61,"value":455,"target":11},{"source":49,"value":455,"target":1},{"source":61,"value":91692,"target":13},{"source":49,"value":92373,"target":5},{"source":58,"value":975,"target":24},{"source":61,"value":455,"target":5},{"source":58,"value":911,"target":15},{"source":61,"value":455,"target":1},{"source":61,"value":455,"target":8},{"source":61,"value":455,"target":6},{"source":49,"value":455,"target":13},{"source":63,"value":455,"target":9},{"source":63,"value":455,"target":13},{"source":58,"value":1191,"target":22},{"source":58,"value":866,"target":21},{"source":58,"value":930,"target":25},{"source":84,"value":455,"target":7},{"source":84,"value":455,"target":4},{"source":84,"value":455,"target":3},{"source":84,"value":455,"target":12},{"source":84,"value":455,"target":28},{"source":84,"value":455,"target":16},{"source":84,"value":281199,"target":29},{"source":95,"value":455,"target":3},{"source":88,"value":455,"target":4},{"source":33,"value":92006,"target":8},{"source":95,"value":455,"target":12},{"source":88,"value":455,"target":3},{"source":33,"value":455,"target":6},{"source":95,"value":455,"target":28},{"source":33,"value":455,"target":5},{"source":95,"value":455,"target":16},{"source":88,"value":455,"target":7},{"source":33,"value":455,"target":1},{"source":95,"value":275303,"target":7},{"source":95,"value":455,"target":4},{"source":94,"value":455,"target":7},{"source":33,"value":455,"target":13},{"source":33,"value":455,"target":9},{"source":33,"value":455,"target":11},{"source":3,"value":38606,"target":59},{"source":3,"value":38846,"target":47},{"source":31,"value":455,"target":5},{"source":31,"value":92019,"target":1},{"source":31,"value":455,"target":8},{"source":78,"value":455,"target":58},{"source":78,"value":455,"target":14},{"source":78,"value":455,"target":42},{"source":4,"value":38483,"target":59},{"source":78,"value":455,"target":41},{"source":78,"value":455,"target":50},{"source":31,"value":455,"target":11},{"source":31,"value":455,"target":6},{"source":31,"value":455,"target":13},{"source":95,"value":455,"target":29},{"source":31,"value":455,"target":9},{"source":78,"value":455,"target":43},{"source":78,"value":266198,"target":35},{"source":4,"value":38917,"target":47},{"source":39,"value":92373,"target":5},{"source":39,"value":455,"target":1},{"source":39,"value":455,"target":9},{"source":39,"value":455,"target":11},{"source":39,"value":455,"target":6},{"source":39,"value":455,"target":8},{"source":39,"value":455,"target":13},{"source":28,"value":38590,"target":59},{"source":28,"value":39047,"target":47},{"source":82,"value":455,"target":28},{"source":82,"value":455,"target":16},{"source":82,"value":455,"target":29},{"source":82,"value":455,"target":7},{"source":82,"value":455,"target":4},{"source":82,"value":281541,"target":3},{"source":82,"value":455,"target":12},{"source":94,"value":279656,"target":4},{"source":94,"value":455,"target":3},{"source":94,"value":455,"target":12},{"source":94,"value":455,"target":28},{"source":94,"value":455,"target":16},{"source":94,"value":455,"target":29},{"source":64,"value":455,"target":5},{"source":88,"value":455,"target":28},{"source":64,"value":455,"target":8},{"source":88,"value":455,"target":12},{"source":64,"value":455,"target":1},{"source":88,"value":276461,"target":29},{"source":64,"value":455,"target":11},{"source":88,"value":455,"target":16},{"source":64,"value":455,"target":6},{"source":64,"value":92017,"target":13},{"source":64,"value":455,"target":9},{"source":12,"value":38949,"target":47},{"source":27,"value":455,"target":29},{"source":12,"value":38789,"target":59},{"source":27,"value":455,"target":12},{"source":27,"value":455,"target":3},{"source":27,"value":455,"target":16},{"source":27,"value":455,"target":28}]}');

  sankey
      .nodes(graph.nodes)
      .links(graph.links)
      .layout(32);

// add in the links
  var link = svg.append("g").selectAll(".link")
      .data(graph.links)
    .enter().append("path")
      .attr("class", "link")
      .attr("d", path)
      .style("stroke-width", function(d) { return Math.max(1, d.dy); })
      .sort(function(a, b) { return b.dy - a.dy; });

// add the link titles
  link.append("title")
        .text(function(d) {
            return d.source.name + " → " + 
                d.target.name + "\n" + format(d.value); });

// add in the nodes
  var node = svg.append("g").selectAll(".node")
      .data(graph.nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { 
          return "translate(" + d.x + "," + d.y + ")"; })
    .call(d3.behavior.drag()
      .origin(function(d) { return d; })
      .on("dragstart", function() { 
          this.parentNode.appendChild(this); })
      .on("drag", dragmove));

// add the rectangles for the nodes
  node.append("rect")
      .attr("height", function(d) { return d.dy; })
      .attr("width", sankey.nodeWidth())
      .style("fill", function(d) { 
          return d.color = color(d.name.replace(/ .*/, "")); })
      .style("stroke", function(d) { 
          return d3.rgb(d.color).darker(2); })
    .append("title")
      .text(function(d) { 
          return d.name + "\n" + format(d.value); });

// add in the title for the nodes
  node.append("text")
      .attr("x", -6)
      .attr("y", function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", "end")
      .attr("transform", null)
      .text(function(d) { return d.name; })
    .filter(function(d) { return d.x < width / 2; })
      .attr("x", 6 + sankey.nodeWidth())
      .attr("text-anchor", "start");

// the function for moving the nodes
  function dragmove(d) {
    d3.select(this).attr("transform", 
        "translate(" + (
            d.x = Math.max(0, Math.min(width - d.dx, d3.event.x))
        )
        + "," + (
            d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))
        ) + ")");
    sankey.relayout();
    link.attr("d", path);
  }

</script>
</body>
</html>
