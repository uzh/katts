<html title="sankey">

<style>
.node rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}
.node text {
  pointer-events: none;
  text-shadow: 0 1px 0 #fff;
}
.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}
.link:hover {
  stroke-opacity: .5;
}
</style>

<body>
<p id="chart">
<script type="text/javascript" src="http://d3js.org/d3.v2.min.js"></script>
<script type="text/javascript" src="https://raw.github.com/d3/d3-plugins/master/sankey/sankey.js"></script>
<script>
var units = "Messages";

var margin = {top: 10, right: 10, bottom: 10, left: 10},
    width = 2000 - margin.left - margin.right,
    height =2000 - margin.top - margin.bottom;

var formatNumber = d3.format(",.0f"),    // zero decimal places
    format = function(d) { return formatNumber(d) + " " + units; },
    color = d3.scale.category20();

// append the svg canvas to the page
var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

// Set the sankey diagram properties
var sankey = d3.sankey()
    .nodeWidth(36)
    .nodePadding(40)
    .size([width, height]);

var path = sankey.link();

graph = JSON.parse('{"nodes":[{"name":"100"},{"name":"67"},{"name":"66"},{"name":"65"},{"name":"64"},{"name":"63"},{"name":"62"},{"name":"61"},{"name":"60"},{"name":"2"},{"name":"94"},{"name":"21"},{"name":"79"},{"name":"97"},{"name":"57"},{"name":"68"},{"name":"69"},{"name":"29"},{"name":"73"},{"name":"54"},{"name":"53"},{"name":"56"},{"name":"55"},{"name":"50"},{"name":"6"},{"name":"90"},{"name":"52"},{"name":"51"},{"name":"86"},{"name":"26"},{"name":"33"},{"name":"58"},{"name":"59"},{"name":"85"},{"name":"84"},{"name":"83"},{"name":"82"},{"name":"89"},{"name":"88"},{"name":"87"},{"name":"70"},{"name":"81"},{"name":"80"},{"name":"3"},{"name":"95"},{"name":"23"},{"name":"91"},{"name":"76"},{"name":"72"},{"name":"71"},{"name":"74"},{"name":"106"},{"name":"98"},{"name":"75"},{"name":"78"},{"name":"77"},{"name":"19"},{"name":"99"},{"name":"1"},{"name":"4"},{"name":"5"},{"name":"7"},{"name":"18"},{"name":"8"},{"name":"9"},{"name":"92"},{"name":"93"},{"name":"96"},{"name":"20"},{"name":"36"},{"name":"49"},{"name":"101"},{"name":"35"},{"name":"34"},{"name":"32"},{"name":"16"},{"name":"38"},{"name":"31"},{"name":"30"},{"name":"17"},{"name":"13"},{"name":"12"},{"name":"15"},{"name":"14"},{"name":"22"},{"name":"39"},{"name":"37"},{"name":"24"},{"name":"28"},{"name":"27"},{"name":"25"},{"name":"11"},{"name":"10"},{"name":"102"},{"name":"40"},{"name":"41"},{"name":"42"},{"name":"43"},{"name":"44"},{"name":"48"},{"name":"47"},{"name":"46"},{"name":"45"}],"links":[{"source":50,"value":2993,"target":13},{"source":73,"value":834,"target":54},{"source":4,"value":3083,"target":13},{"source":58,"value":324,"target":16},{"source":74,"value":773,"target":65},{"source":8,"value":2964,"target":13},{"source":0,"value":20441,"target":66},{"source":58,"value":797,"target":7},{"source":0,"value":20279,"target":65},{"source":0,"value":20363,"target":46},{"source":0,"value":20244,"target":25},{"source":0,"value":20361,"target":67},{"source":73,"value":768,"target":10},{"source":0,"value":20559,"target":44},{"source":0,"value":20194,"target":10},{"source":60,"value":773,"target":70},{"source":17,"value":335,"target":70},{"source":0,"value":20144,"target":39},{"source":0,"value":20595,"target":38},{"source":0,"value":20242,"target":37},{"source":0,"value":20506,"target":34},{"source":0,"value":20683,"target":35},{"source":0,"value":20686,"target":28},{"source":0,"value":20386,"target":33},{"source":0,"value":20185,"target":42},{"source":0,"value":20051,"target":36},{"source":17,"value":747,"target":18},{"source":0,"value":20563,"target":41},{"source":51,"value":9205066,"target":71},{"source":51,"value":9205066,"target":0},{"source":0,"value":20307,"target":54},{"source":0,"value":20342,"target":12},{"source":0,"value":20364,"target":47},{"source":0,"value":20324,"target":55},{"source":0,"value":20411,"target":53},{"source":15,"value":3019,"target":13},{"source":17,"value":1109,"target":3},{"source":0,"value":20455,"target":50},{"source":0,"value":20303,"target":18},{"source":0,"value":20528,"target":48},{"source":0,"value":20527,"target":49},{"source":0,"value":20364,"target":40},{"source":58,"value":1198,"target":33},{"source":83,"value":1146,"target":23},{"source":0,"value":20369,"target":2},{"source":53,"value":2976,"target":13},{"source":52,"value":3176,"target":64},{"source":0,"value":20188,"target":3},{"source":52,"value":3050,"target":63},{"source":0,"value":20396,"target":15},{"source":52,"value":3111,"target":61},{"source":0,"value":20588,"target":1},{"source":0,"value":20656,"target":16},{"source":3,"value":2935,"target":13},{"source":52,"value":3026,"target":9},{"source":52,"value":3087,"target":58},{"source":52,"value":3136,"target":24},{"source":52,"value":3035,"target":60},{"source":52,"value":3095,"target":59},{"source":52,"value":3095,"target":43},{"source":44,"value":3009,"target":13},{"source":30,"value":747,"target":55},{"source":88,"value":298,"target":67},{"source":5,"value":2976,"target":13},{"source":10,"value":2961,"target":13},{"source":0,"value":20402,"target":8},{"source":60,"value":303,"target":18},{"source":0,"value":20203,"target":7},{"source":0,"value":20284,"target":6},{"source":0,"value":20130,"target":5},{"source":18,"value":2971,"target":13},{"source":0,"value":20448,"target":4},{"source":0,"value":20517,"target":14},{"source":64,"value":345,"target":55},{"source":0,"value":20310,"target":21},{"source":0,"value":20677,"target":22},{"source":0,"value":20440,"target":19},{"source":0,"value":20359,"target":32},{"source":74,"value":313,"target":26},{"source":0,"value":20068,"target":31},{"source":30,"value":703,"target":66},{"source":88,"value":805,"target":38},{"source":7,"value":3003,"target":13},{"source":17,"value":741,"target":37},{"source":84,"value":1189,"target":31},{"source":0,"value":20790,"target":26},{"source":0,"value":20489,"target":20},{"source":0,"value":20619,"target":23},{"source":60,"value":1178,"target":37},{"source":0,"value":20405,"target":27},{"source":64,"value":795,"target":16},{"source":0,"value":20255,"target":70},{"source":1,"value":3122,"target":13},{"source":63,"value":799,"target":15},{"source":88,"value":788,"target":48},{"source":74,"value":782,"target":47},{"source":13,"value":139194,"target":93},{"source":63,"value":743,"target":26},{"source":64,"value":809,"target":20},{"source":16,"value":3136,"target":13},{"source":30,"value":1254,"target":16},{"source":59,"value":774,"target":4},{"source":88,"value":1191,"target":4},{"source":70,"value":3042,"target":13},{"source":60,"value":776,"target":3},{"source":74,"value":1158,"target":15},{"source":76,"value":1192,"target":50},{"source":57,"value":20312,"target":84},{"source":51,"value":9205066,"target":57},{"source":69,"value":760,"target":42},{"source":57,"value":20750,"target":45},{"source":51,"value":9205066,"target":52},{"source":57,"value":20617,"target":87},{"source":48,"value":2997,"target":13},{"source":57,"value":20507,"target":90},{"source":57,"value":20490,"target":29},{"source":57,"value":20464,"target":89},{"source":57,"value":20679,"target":88},{"source":57,"value":20405,"target":17},{"source":76,"value":756,"target":36},{"source":57,"value":20601,"target":78},{"source":57,"value":20721,"target":74},{"source":57,"value":20512,"target":77},{"source":84,"value":303,"target":25},{"source":77,"value":287,"target":27},{"source":35,"value":3034,"target":13},{"source":57,"value":20540,"target":56},{"source":11,"value":1245,"target":14},{"source":24,"value":318,"target":50},{"source":6,"value":3017,"target":13},{"source":57,"value":20628,"target":80},{"source":57,"value":20505,"target":83},{"source":57,"value":20584,"target":91},{"source":57,"value":20380,"target":81},{"source":57,"value":20457,"target":79},{"source":57,"value":20670,"target":62},{"source":57,"value":20666,"target":82},{"source":34,"value":3027,"target":13},{"source":57,"value":20881,"target":75},{"source":30,"value":324,"target":20},{"source":57,"value":20679,"target":11},{"source":57,"value":20642,"target":68},{"source":36,"value":3006,"target":13},{"source":41,"value":3060,"target":13},{"source":63,"value":331,"target":47},{"source":11,"value":760,"target":3},{"source":47,"value":3004,"target":13},{"source":95,"value":743,"target":33},{"source":84,"value":818,"target":2},{"source":79,"value":324,"target":33},{"source":89,"value":1147,"target":5},{"source":89,"value":791,"target":49},{"source":57,"value":20177,"target":92},{"source":69,"value":725,"target":67},{"source":52,"value":3093,"target":91},{"source":52,"value":3014,"target":92},{"source":95,"value":1192,"target":55},{"source":68,"value":793,"target":42},{"source":79,"value":747,"target":55},{"source":68,"value":327,"target":38},{"source":57,"value":20610,"target":24},{"source":84,"value":819,"target":36},{"source":61,"value":1172,"target":46},{"source":57,"value":20542,"target":61},{"source":57,"value":20709,"target":59},{"source":57,"value":20433,"target":60},{"source":57,"value":20604,"target":9},{"source":57,"value":21767,"target":43},{"source":57,"value":20641,"target":58},{"source":63,"value":1171,"target":65},{"source":11,"value":791,"target":41},{"source":57,"value":20491,"target":63},{"source":24,"value":1227,"target":25},{"source":57,"value":20503,"target":64},{"source":68,"value":1214,"target":21},{"source":79,"value":770,"target":7},{"source":11,"value":330,"target":37},{"source":52,"value":3086,"target":88},{"source":52,"value":3020,"target":89},{"source":86,"value":822,"target":41},{"source":62,"value":785,"target":6},{"source":52,"value":2934,"target":17},{"source":52,"value":3147,"target":87},{"source":52,"value":3209,"target":45},{"source":58,"value":763,"target":66},{"source":52,"value":3132,"target":29},{"source":52,"value":3094,"target":90},{"source":52,"value":3083,"target":78},{"source":52,"value":2995,"target":77},{"source":67,"value":2896,"target":13},{"source":52,"value":3029,"target":74},{"source":52,"value":3032,"target":30},{"source":86,"value":1230,"target":18},{"source":77,"value":772,"target":46},{"source":72,"value":774,"target":12},{"source":78,"value":349,"target":23},{"source":68,"value":816,"target":4},{"source":79,"value":1130,"target":20},{"source":72,"value":766,"target":44},{"source":61,"value":325,"target":53},{"source":52,"value":3030,"target":56},{"source":52,"value":3096,"target":62},{"source":52,"value":2976,"target":79},{"source":52,"value":3145,"target":75},{"source":75,"value":788,"target":8},{"source":52,"value":3049,"target":82},{"source":65,"value":2989,"target":13},{"source":62,"value":1230,"target":19},{"source":52,"value":3005,"target":83},{"source":66,"value":2987,"target":13},{"source":52,"value":3063,"target":80},{"source":52,"value":2987,"target":81},{"source":75,"value":1296,"target":26},{"source":52,"value":3129,"target":11},{"source":52,"value":3131,"target":84},{"source":52,"value":3154,"target":68},{"source":82,"value":815,"target":32},{"source":82,"value":1192,"target":27},{"source":57,"value":20374,"target":99},{"source":57,"value":20392,"target":102},{"source":57,"value":20550,"target":98},{"source":57,"value":20725,"target":100},{"source":57,"value":20350,"target":101},{"source":62,"value":318,"target":28},{"source":52,"value":2967,"target":101},{"source":52,"value":3036,"target":102},{"source":52,"value":2934,"target":99},{"source":52,"value":3102,"target":100},{"source":61,"value":810,"target":1},{"source":24,"value":768,"target":2},{"source":86,"value":333,"target":14},{"source":75,"value":327,"target":34},{"source":77,"value":759,"target":53},{"source":73,"value":322,"target":19},{"source":72,"value":325,"target":22},{"source":69,"value":298,"target":21},{"source":37,"value":2998,"target":13},{"source":78,"value":767,"target":50},{"source":57,"value":20563,"target":85},{"source":57,"value":20397,"target":76},{"source":69,"value":1144,"target":48},{"source":57,"value":20483,"target":86},{"source":57,"value":20423,"target":69},{"source":72,"value":1215,"target":49},{"source":57,"value":20674,"target":72},{"source":61,"value":798,"target":27},{"source":57,"value":20461,"target":73},{"source":57,"value":20751,"target":30},{"source":62,"value":760,"target":54},{"source":52,"value":3173,"target":86},{"source":52,"value":2931,"target":69},{"source":52,"value":3083,"target":72},{"source":24,"value":821,"target":23},{"source":52,"value":3099,"target":73},{"source":52,"value":3131,"target":85},{"source":52,"value":3065,"target":76},{"source":73,"value":1173,"target":40},{"source":52,"value":3084,"target":94},{"source":75,"value":733,"target":47},{"source":52,"value":3124,"target":97},{"source":52,"value":3059,"target":98},{"source":52,"value":3078,"target":95},{"source":77,"value":1176,"target":1},{"source":52,"value":3132,"target":96},{"source":57,"value":20848,"target":96},{"source":57,"value":20509,"target":97},{"source":78,"value":1170,"target":2},{"source":57,"value":20615,"target":94},{"source":57,"value":20568,"target":95},{"source":91,"value":1174,"target":44},{"source":83,"value":759,"target":50},{"source":92,"value":1170,"target":10},{"source":82,"value":737,"target":53},{"source":54,"value":3083,"target":13},{"source":82,"value":305,"target":35},{"source":56,"value":758,"target":12},{"source":83,"value":319,"target":36},{"source":98,"value":783,"target":38},{"source":76,"value":327,"target":31},{"source":76,"value":789,"target":23},{"source":78,"value":794,"target":25},{"source":99,"value":1145,"target":34},{"source":99,"value":743,"target":65},{"source":92,"value":308,"target":54},{"source":56,"value":297,"target":39},{"source":100,"value":795,"target":46},{"source":91,"value":321,"target":12},{"source":83,"value":778,"target":31},{"source":86,"value":787,"target":70},{"source":92,"value":784,"target":40},{"source":46,"value":3054,"target":13},{"source":100,"value":1192,"target":35},{"source":87,"value":1209,"target":8},{"source":100,"value":362,"target":1},{"source":12,"value":3025,"target":13},{"source":31,"value":3003,"target":13},{"source":90,"value":343,"target":66},{"source":97,"value":785,"target":39},{"source":49,"value":3089,"target":13},{"source":97,"value":1214,"target":12},{"source":90,"value":768,"target":33},{"source":97,"value":820,"target":22},{"source":55,"value":2994,"target":13},{"source":100,"value":752,"target":32},{"source":87,"value":805,"target":34},{"source":102,"value":733,"target":14},{"source":96,"value":767,"target":19},{"source":99,"value":713,"target":8},{"source":95,"value":832,"target":20},{"source":101,"value":745,"target":31},{"source":94,"value":1205,"target":47},{"source":45,"value":808,"target":35},{"source":45,"value":823,"target":1},{"source":97,"value":299,"target":5},{"source":29,"value":795,"target":40},{"source":87,"value":783,"target":15},{"source":98,"value":352,"target":4},{"source":29,"value":1193,"target":6},{"source":98,"value":753,"target":21},{"source":96,"value":330,"target":6},{"source":85,"value":816,"target":27},{"source":95,"value":308,"target":7},{"source":94,"value":807,"target":34},{"source":90,"value":803,"target":16},{"source":85,"value":341,"target":32},{"source":90,"value":1178,"target":7},{"source":45,"value":1225,"target":32},{"source":101,"value":1158,"target":36},{"source":25,"value":3041,"target":13},{"source":42,"value":2990,"target":13},{"source":85,"value":773,"target":35},{"source":96,"value":1237,"target":54},{"source":94,"value":771,"target":26},{"source":99,"value":329,"target":15},{"source":98,"value":1168,"target":42},{"source":29,"value":315,"target":10},{"source":29,"value":823,"target":28},{"source":87,"value":347,"target":65},{"source":96,"value":793,"target":28},{"source":85,"value":1197,"target":53},{"source":94,"value":295,"target":8},{"source":101,"value":311,"target":2},{"source":40,"value":3036,"target":13},{"source":71,"value":20601,"target":78},{"source":81,"value":1139,"target":67},{"source":59,"value":1205,"target":38},{"source":9,"value":1187,"target":28},{"source":71,"value":20563,"target":85},{"source":71,"value":20674,"target":72},{"source":71,"value":20423,"target":69},{"source":71,"value":20483,"target":86},{"source":71,"value":20397,"target":76},{"source":71,"value":20512,"target":77},{"source":71,"value":20641,"target":58},{"source":71,"value":20721,"target":74},{"source":71,"value":20751,"target":30},{"source":71,"value":20461,"target":73},{"source":71,"value":20568,"target":95},{"source":71,"value":20615,"target":94},{"source":81,"value":318,"target":42},{"source":102,"value":782,"target":37},{"source":9,"value":329,"target":40},{"source":80,"value":317,"target":41},{"source":2,"value":3022,"target":13},{"source":59,"value":337,"target":48},{"source":71,"value":20374,"target":99},{"source":71,"value":20350,"target":101},{"source":71,"value":20725,"target":100},{"source":71,"value":20550,"target":98},{"source":71,"value":20392,"target":102},{"source":71,"value":20848,"target":96},{"source":71,"value":20509,"target":97},{"source":101,"value":751,"target":25},{"source":81,"value":769,"target":48},{"source":89,"value":743,"target":39},{"source":71,"value":20457,"target":79},{"source":71,"value":20670,"target":62},{"source":71,"value":20540,"target":56},{"source":102,"value":1182,"target":41},{"source":71,"value":20177,"target":92},{"source":71,"value":20584,"target":91},{"source":71,"value":20380,"target":81},{"source":71,"value":20628,"target":80},{"source":71,"value":20505,"target":83},{"source":71,"value":20666,"target":82},{"source":71,"value":20881,"target":75},{"source":45,"value":352,"target":46},{"source":43,"value":781,"target":44},{"source":9,"value":752,"target":10},{"source":59,"value":777,"target":67},{"source":89,"value":338,"target":44},{"source":102,"value":337,"target":3},{"source":71,"value":20679,"target":88},{"source":71,"value":20405,"target":17},{"source":71,"value":20312,"target":84},{"source":71,"value":20750,"target":45},{"source":71,"value":20642,"target":68},{"source":71,"value":20679,"target":11},{"source":71,"value":20490,"target":29},{"source":71,"value":20464,"target":89},{"source":71,"value":20617,"target":87},{"source":81,"value":757,"target":21},{"source":71,"value":20507,"target":90},{"source":92,"value":748,"target":19},{"source":43,"value":1168,"target":39},{"source":80,"value":1188,"target":70},{"source":43,"value":349,"target":49},{"source":21,"value":2979,"target":13},{"source":19,"value":3020,"target":13},{"source":22,"value":3107,"target":13},{"source":9,"value":755,"target":6},{"source":28,"value":3078,"target":13},{"source":80,"value":735,"target":18},{"source":56,"value":1196,"target":22},{"source":33,"value":2992,"target":13},{"source":39,"value":2952,"target":13},{"source":43,"value":793,"target":5},{"source":91,"value":786,"target":49},{"source":14,"value":3089,"target":13},{"source":38,"value":3071,"target":13},{"source":91,"value":806,"target":22},{"source":23,"value":3062,"target":13},{"source":56,"value":776,"target":5},{"source":71,"value":20542,"target":61},{"source":71,"value":20610,"target":24},{"source":71,"value":20503,"target":64},{"source":27,"value":3046,"target":13},{"source":71,"value":20491,"target":63},{"source":71,"value":20549,"target":43},{"source":71,"value":20604,"target":9},{"source":71,"value":20433,"target":60},{"source":71,"value":20709,"target":59},{"source":32,"value":3086,"target":13},{"source":20,"value":3051,"target":13},{"source":80,"value":820,"target":14},{"source":26,"value":3071,"target":13}]}');

  sankey
      .nodes(graph.nodes)
      .links(graph.links)
      .layout(32);

// add in the links
  var link = svg.append("g").selectAll(".link")
      .data(graph.links)
    .enter().append("path")
      .attr("class", "link")
      .attr("d", path)
      .style("stroke-width", function(d) { return Math.max(1, d.dy); })
      .sort(function(a, b) { return b.dy - a.dy; });

// add the link titles
  link.append("title")
        .text(function(d) {
            return d.source.name + " → " + 
                d.target.name + "\n" + format(d.value); });

// add in the nodes
  var node = svg.append("g").selectAll(".node")
      .data(graph.nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { 
          return "translate(" + d.x + "," + d.y + ")"; })
    .call(d3.behavior.drag()
      .origin(function(d) { return d; })
      .on("dragstart", function() { 
          this.parentNode.appendChild(this); })
      .on("drag", dragmove));

// add the rectangles for the nodes
  node.append("rect")
      .attr("height", function(d) { return d.dy; })
      .attr("width", sankey.nodeWidth())
      .style("fill", function(d) { 
          return d.color = color(d.name.replace(/ .*/, "")); })
      .style("stroke", function(d) { 
          return d3.rgb(d.color).darker(2); })
    .append("title")
      .text(function(d) { 
          return d.name + "\n" + format(d.value); });

// add in the title for the nodes
  node.append("text")
      .attr("x", -6)
      .attr("y", function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", "end")
      .attr("transform", null)
      .text(function(d) { return d.name; })
    .filter(function(d) { return d.x < width / 2; })
      .attr("x", 6 + sankey.nodeWidth())
      .attr("text-anchor", "start");

// the function for moving the nodes
  function dragmove(d) {
    d3.select(this).attr("transform", 
        "translate(" + (
            d.x = Math.max(0, Math.min(width - d.dx, d3.event.x))
        )
        + "," + (
            d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))
        ) + ")");
    sankey.relayout();
    link.attr("d", path);
  }

</script>
</body>
</html>
